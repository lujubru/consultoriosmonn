{% extends "base.html" %}

{% block title %}{{ 'Editar' if usuario else 'Nuevo' }} Usuario Administrativo{% endblock %}

{% block content %}
<div class="container">
    <div class="form-container" style="max-width: 600px;">
        <h1>{{ 'Editar' if usuario else 'Nuevo' }} Usuario Administrativo</h1>

        <form method="POST">
            <fieldset>
                <legend>Datos Personales</legend>

                <div class="form-row">
                    <div class="form-group">
                        <label for="nombre">Nombre *</label>
                        <input type="text" id="nombre" name="nombre" class="form-control"
                               value="{{ usuario.nombre if usuario else '' }}" required>
                    </div>

                    <div class="form-group">
                        <label for="apellido">Apellido *</label>
                        <input type="text" id="apellido" name="apellido" class="form-control"
                               value="{{ usuario.apellido if usuario else '' }}" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dni">DNI *</label>
                        <input type="text" id="dni" name="dni" class="form-control"
                               value="{{ usuario.dni if usuario else '' }}"
                               pattern="[0-9]{7,8}"
                               {{ 'readonly' if usuario }} required>
                    </div>

                    <div class="form-group">
                        <label for="telefono">Teléfono</label>
                        <input type="tel" id="telefono" name="telefono" class="form-control"
                               value="{{ usuario.telefono if usuario else '' }}">
                    </div>
                </div>

                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" class="form-control"
                           value="{{ usuario.email if usuario else '' }}" required>
                </div>

                {% if not usuario %}
                <div class="form-group">
                    <label for="password">Contraseña *</label>
                    <input type="password" id="password" name="password" 
                           class="form-control" minlength="6" required>
                    <small class="form-text">Mínimo 6 caracteres</small>
                </div>

                <div class="form-group">
                    <label for="password_confirm">Confirmar Contraseña *</label>
                    <input type="password" id="password_confirm" name="password_confirm" 
                           class="form-control" minlength="6" required>
                </div>
                {% endif %}
            </fieldset>

            <fieldset>
                <legend>Rol y Permisos</legend>

                <div class="form-group">
                    <label for="rol">Rol *</label>
                    <select id="rol" name="rol" class="form-control" required 
                            {{ 'disabled' if usuario }}>
                        <option value="">Seleccionar...</option>
                        <option value="admin" 
                                {{ 'selected' if usuario and usuario.rol.value == 'admin' }}>
                            Administrador (Acceso completo)
                        </option>
                        <option value="recepcion" 
                                {{ 'selected' if usuario and usuario.rol.value == 'recepcion' }}>
                            Recepción (Acceso limitado)
                        </option>
                    </select>
                </div>

                <div class="alert alert-info">
                    <strong>ℹ️ Permisos según rol:</strong>
                    <ul style="margin-top: 0.5rem; margin-bottom: 0;">
                        <li><strong>Administrador:</strong> Acceso completo al sistema</li>
                        <li><strong>Recepción:</strong> Solo turnos del día, búsqueda de pacientes y pagos en efectivo</li>
                    </ul>
                </div>
            </fieldset>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">
                    {{ 'Actualizar' if usuario else 'Crear' }} Usuario
                </button>
                <a href="{{ url_for('admin.listar_usuarios_admin') }}" class="btn btn-secondary">Cancelar</a>
            </div>
        </form>
    </div>
</div>

{% if not usuario %}
<script>
// Validar que las contraseñas coincidan
document.querySelector('form').addEventListener('submit', function(e) {
    const password = document.getElementById('password').value;
    const confirm = document.getElementById('password_confirm').value;
    
    if (password !== confirm) {
        e.preventDefault();
        alert('Las contraseñas no coinciden');
    }
});
</script>
{% endif %}
{% endblock %}